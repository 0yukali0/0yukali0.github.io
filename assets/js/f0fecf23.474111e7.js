"use strict";(self.webpackChunk_0_yukali_0_github_io=self.webpackChunk_0_yukali_0_github_io||[]).push([[8184],{8410:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>h,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var t=a(4848),s=a(8453);const r={id:"prometheusStack",title:"Prometheus stack\u5b89\u88dd"},h="prometheus\u8207grafana",c={id:"kubernetes-native/base/prometheusStack",title:"Prometheus stack\u5b89\u88dd",description:"\u7372\u53d6prometheus\u8207grafana helm chart",source:"@site/docs/kubernetes-native/base/promethesuStack.md",sourceDirName:"kubernetes-native/base",slug:"/kubernetes-native/base/prometheusStack",permalink:"/docs/kubernetes-native/base/prometheusStack",draft:!1,unlisted:!1,editUrl:"https://github.com/0yukali0/0yukali0.github.io/docs/kubernetes-native/base/promethesuStack.md",tags:[],version:"current",frontMatter:{id:"prometheusStack",title:"Prometheus stack\u5b89\u88dd"}},i={},l=[{value:"\u7372\u53d6prometheus\u8207grafana helm chart",id:"\u7372\u53d6prometheus\u8207grafana-helm-chart",level:2},{value:"\u900f\u904ehelm\u5b89\u88dd",id:"\u900f\u904ehelm\u5b89\u88dd",level:3},{value:"LoadBalance\u670d\u52d9",id:"loadbalance\u670d\u52d9",level:3},{value:"\u9810\u671f\u756b\u9762",id:"\u9810\u671f\u756b\u9762",level:3},{value:"Ingress(\u53ef\u9078)",id:"ingress\u53ef\u9078",level:2},{value:"\u90e8\u5c6cIngress",id:"\u90e8\u5c6cingress",level:3},{value:"\u66f4\u65b0hosts\u6a94",id:"\u66f4\u65b0hosts\u6a94",level:3},{value:"\u9810\u671f\u756b\u9762",id:"\u9810\u671f\u756b\u9762-1",level:3}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"prometheus\u8207grafana",children:"prometheus\u8207grafana"})}),"\n",(0,t.jsx)(n.h2,{id:"\u7372\u53d6prometheus\u8207grafana-helm-chart",children:"\u7372\u53d6prometheus\u8207grafana helm chart"}),"\n",(0,t.jsx)(n.p,{children:"Promethues\u3001alertmanager\u3001CRD\u8207grafana\u7684helm chart\u8a2d\u5b9a\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u900f\u904ehelm\u5b89\u88dd",children:"\u900f\u904ehelm\u5b89\u88dd"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"helm install grafana prometheus-community/kube-prometheus-stack --namespace grafana --create-namespace\n"})}),"\n",(0,t.jsx)(n.h3,{id:"loadbalance\u670d\u52d9",children:"LoadBalance\u670d\u52d9"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'kubectl patch svc grafana -n grafana -p \'{"spec": {"type": "LoadBalancer"}}\'\nkubectl patch svc grafana-kube-prometheus-st-prometheus -n grafana -p \'{"spec": {"type": "LoadBalancer"}}\'\nkubectl patch svc grafana-kube-prometheus-st-alertmanager -n grafana -p \'{"spec": {"type": "LoadBalancer"}}\'\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u9810\u671f\u756b\u9762",children:"\u9810\u671f\u756b\u9762"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Grafana\u7db2\u5740 ",(0,t.jsx)(n.a,{href:"http://192.168.0.171",children:"http://192.168.0.171"})]}),"\n",(0,t.jsxs)(n.li,{children:["Prometheus\u7db2\u5740 ",(0,t.jsx)(n.a,{href:"http://192.168.0.172:9090",children:"http://192.168.0.172:9090"})]}),"\n",(0,t.jsxs)(n.li,{children:["AlertManager\u7db2\u5740 ",(0,t.jsx)(n.a,{href:"http://192.168.0.173:9093",children:"http://192.168.0.173:9093"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Prometheus stack",src:a(1390).A+"",width:"1916",height:"1035"})}),"\n",(0,t.jsx)(n.h2,{id:"ingress\u53ef\u9078",children:"Ingress(\u53ef\u9078)"}),"\n",(0,t.jsx)(n.h3,{id:"\u90e8\u5c6cingress",children:"\u90e8\u5c6cIngress"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: prometheus-stack-ingress\n  namespace: grafana\nspec:\n  ingressClassName: nginx\n  rules:\n  - host: alert.example.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: grafana-kube-prometheus-st-alertmanager\n            port:\n              name: http-web\n  - host: grafana.example.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: grafana\n            port:\n              name: http-web\n  - host: prometheus.example.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: grafana-kube-prometheus-st-prometheus\n            port:\n              name: http-web\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u66f4\u65b0hosts\u6a94",children:"\u66f4\u65b0hosts\u6a94"}),"\n",(0,t.jsx)(n.p,{children:"192.168.0.170\u70baIngress-nginx controller\u7684\u5916\u90e8IP"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"192.168.0.170 grafana.example.com\n192.168.0.170 prometheus.example.com\n192.168.0.170 alert.example.com\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u9810\u671f\u756b\u9762-1",children:"\u9810\u671f\u756b\u9762"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Prometheus stack",src:a(6018).A+"",width:"1915",height:"1025"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},1390:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/loadBlanacerGrafanaAndPrometheus-a15e843f20a5de0e47c414e8eef18865.png"},6018:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/prometheusIngress-335eac63d6af281f635132835fc751cd.png"},8453:(e,n,a)=>{a.d(n,{R:()=>h,x:()=>c});var t=a(6540);const s={},r=t.createContext(s);function h(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:h(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);